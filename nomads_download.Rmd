---
title: "FlowlineFinder Download NOMADs"
theme: flatly
output: html_document
---

This document will be used within a cron job to update National Water Model forecasts for the FlowlineFinder application:

```{r, echo = FALSE}
library(ncdf4)
source("./R/get_nomads_filelist.R")
source("./R/download_nomads_rda.R")
```

First, get a list of most current files on the NOMADs server:

```{r, echo = FALSE}
fileList = get_nomads_filelist(num  = 6)
message("Date:\n", fileList$date, "\n\nTime:\n",fileList$startTime, "\n\nFiles:\n",
paste(basename(fileList$urls), collapse  ="\n"), "\n\n")
```

Check if files need to be updated, and, if so, download them:

```{r, echo = FALSE}

load("./flowline-app/data/current_nc/flows.rda")

if(all(
  fileList$date == nwm$date,
  fileList$startTime == nwm$time
)){
  message("No Download needed...")
} else {
  download_nomads_rda(fileList)
}

```
