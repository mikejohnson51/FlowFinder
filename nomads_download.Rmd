---
title: "Get NOMADs"
theme: flatly
output: html_document
---

This document will be used within a cron job to update National Water Model forecasts for the FlowlineFinder application:

First, we will source the needed functions:

```{r}
source("./R/get_nomads_filelist.R")
source("./R/download_nomads.R")
```

Then, get a list of most current files on the NOMADs server

```{r}
fileList = get_nomads_filelist(num  = 6)
```

Finally we will check if files need to be updated, and, if so, downloaded:

```{r}
files = list.files("./flowline-app/data/current_nc", full.names = TRUE)

testFiles = paste0(fileList[[1]], basename(fileList[[2]]))

# remove the files not in the list from folder
file.remove(files[!(basename(files) %in% testFiles)])

# remove files in the folder from the file list

fileList[[2]] = fileList[[2]][!(testFiles %in% basename(files))]

if(length(fileList[[2]] > 0)){
  download_nomads(fileList = fileList)
}else {
  message("No Download needed...")
}

```
